<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Visualisation in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr. Laurie Baker" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="gentle-ggplot2.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data Visualisation in R
## Introduction to ggplot2 and leaflet
### Dr. Laurie Baker
### Data Science Campus
### 2020/04/09 (updated: 2020-04-17)

---


layout: false
class: inverse center middle text-white

.font200[Introduction to ggplot2]



---
layout: true
# What we'll cover today.
---

- Brief intro to the theory behind `ggplot2` and the "grammar of graphics".

- Building a plot using `ggplot`.

- Building interactives maps using leaflet. 

- Slides and code adapted from Garrick Aden-Buie "Gentle ggplot2 tutorial" on GitHub: &lt;http://github.com/gadenbuie/gentle-ggplot2&gt;


---
layout: true
# How would you draw a line graph by hand?
---

.left-column[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.60 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.30 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.86 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.20 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19.30 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.right-column[.font150[

1. Draw the axes, add tick marks.

2. Draw each line. Colour by country.

3. Add the axes labels.

4. Add a title.

5. Add a legend.

]]

---
layout: true
# How would you draw a bar graph by hand?
---

.left-column[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.60 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.30 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.86 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.20 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19.30 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.right-column[.font150[

1. Draw the axes, add tick marks.

2. **Draw each bar.** Colour by country.

3. Add the axes labels.

4. Add a title.

5. Add a legend.

]]


---
layout: true
# How would you draw a graph?
---

.left-column[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.60 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.30 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.86 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.20 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19.30 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.right-column[.font150[

1. What decisions did you make?

2. How did the data inform them?

3. Did you look at the values to decide the axes and tick marks?

4. How did you decide the labels?

]]



---

---
layout: true
# The grammar of graphics
---

.left-column[
![](images/grammar_graphics_book.jfif)
__Grammar of Graphics__
]

.right-column[

* Computers also follow steps.

* The **grammar of graphics =** rules/steps for plotting.

* First published in 1999.

* Breaks down graphics into its constituent parts. 

*  Focus on the relationship between the **variables** and the *visual properties* of the graph (e.g. *colour* = **country**).

* Foundation for **ggplot2**, **tableau**, **vegalite** etc. 


]

---
layout: true
# The grammar of graphics
---

.left-column[
.font150[Links between variables and visual properties of the graph.
]]

.right-column[

![](images/ggplot_links_thomas_lin_pedersen.png)
__Thomas Lin Pedersen: Plot Anything With GGPLOT2__


]

---
layout: true
# What is *ggplot2*?
---

.left-column[
![](images/hadley.jpg)
__Hadley Wickham__
]

.right-column[.font150[

* **gg**plot2 is the implementation of the **g**rammar of **g**raphics in R with some adaptations.

* ..."a powerful way of thinking about visualisation, as a way of **mapping between variables and the visual properties of geometric objects** that you can perceive."



]
.footnote[&lt;http://disq.us/p/sv640d&gt;]
]

---
layout: true
# Why use *ggplot2*?
---

- Package for .hl[functional] data visualization.

--
    1. Wrangle data
    
--

    2. Map data to visual elements
    
--

    3. Tweak scales, guides, axis, labels, theme
    
--

- Once you know the syntax it is easy to

--

  - .hl[Reason] about how data drives visualization

--

  - .hl[Iterate] to create multiple visualizations

--

  - Be .hl[consistent] in the visualizations you make.

---
layout: false

# Learning objectives

.left-column[
![](images/ggplot2_book.jfif)
__ggplot2__
]

.right-column[.font150[
* `ggplot2` is a huge package with lots of options, but it's well documented and organized.


* We'll cover a lot, but won't have time to go into every specific. 



* The aim is to **equip** you with **where** and **what** to look for. 

]]


---
layout: true
# Getting started

---


**Option 1**: install the metapackage [tidyverse](http://tidyverse.org)

```r
install.packages('tidyverse')
```

**Option 2**: install just `ggplot2`

```r
install.packages('ggplot2')
```
---

## Load the tidyverse


```r
library(tidyverse)
```

```
## -- Attaching packages ----------------------------------------------------------------- tidyverse 1.3.0 --
```

```
## v ggplot2 3.2.1     v purrr   0.3.3
## v tibble  2.1.3     v dplyr   0.8.3
## v tidyr   1.0.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0
```

```
## -- Conflicts -------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
```

---
## Other packages you'll need for this adventure

* [gapminder](http://www.gapminder.org/data/) dataset from the [`gapminder` package](https://github.com/jennybc/gapminder) by Jenny Bryan.



```r
## install.packages("gapminder")
library(gapminder)
```

---
layout: false
class: inverse center middle text-white

.font200[gg is for&lt;br&gt;Grammar of Graphics]


---

# Every plot starts with data


.left-code[
### MPG Ratings of Cars

- Manufacturer
- Car Type (Class)
- City MPG
- Highway MPG

]

.right-plot[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; manufacturer &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; class &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; cty &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; hwy &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; model &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; audi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; compact &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; a4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; audi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; compact &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; a4 quattro &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ford &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; suv &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; expedition 2wd &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ford &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; suv &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; explorer 4wd &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; toyota &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; suv &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4runner 4wd &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; toyota &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; compact &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; camry solara &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; toyota &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; compact &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; corolla &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; toyota &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; suv &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; land cruiser wagon 4wd &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]


---
layout: true
# Guess the data behind this plot?
---

.left-code[
### MPG Ratings of Cars

- Manufacturer
- Car Type (Class)
- City MPG
- Highway MPG

#### What variable is represented by point shape?
]


.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-2-1.png" width="100%" /&gt;
]

---
layout: true
# Guess the data behind this plot?
---

.left-code[
### MPG Ratings of Cars

- **Manufacturer**
- Car Type (Class)
- City MPG
- Highway MPG

#### What variable is represented by colour?
]

.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-3-1.png" width="100%" /&gt;
]

---
layout: true
# Guess the data behind this plot?
---

.left-code[
### MPG Ratings of Cars

- Manufacturer
- **Car Type (Class)**
- City MPG
- Highway MPG


#### What variable is represented on the x axis?


]
.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-1-1.png" width="100%" /&gt;
]

---
layout: true
# Guess the data behind this plot?
---

.left-code[
### MPG Ratings of Cars

- Manufacturer
- Car Type (Class)
- **City MPG**
- Highway MPG


#### What variable is on the Y axis?

]

.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-5-1.png" width="100%" /&gt;
]

---
layout: true
# Guess the data behind this plot?
---

.left-code[
### MPG Ratings of Cars

- Manufacturer
- Car Type (Class)
- City MPG
- **Highway MPG**


#### What is the title of the plot?

]

.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-6-1.png" width="100%" /&gt;
]

---
layout: true
# Guess the data behind this plot?
---

.left-code[
### **MPG Ratings of Cars**

- Manufacturer
- Car Type (Class)
- City MPG
- Highway MPG
]

.right-plot[
&lt;img src="index_files/figure-html/guess-data-from-plot-7-1.png" width="100%" /&gt;
]


---
layout: false
# How do we express visuals in words?

.font120[
- **Data** to be visualized
]

--
.font120[
- **.hlb[Aes]thetic mappings** from data to visual component
]

--
.font120[
- **.hlb[Geom]etric objects** that appear on the plot
]

--
.font120[
- **.hlb[Stat]istics** transform data on the way to visualization
]

--
.font120[
- **.hlb[Coord]inates** organize location of geometric objects
]

--
.font120[
- **.hlb[Scale]s** define the range of values for aesthetics
]

--
.font120[
- **.hlb[Facet]s** group into subplots
]

--

--
.font120[
- **.hlb[Theme]s** the visual elements of the plot not linked to the data
]


---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data

```r
ggplot(data)
```
]

---

.right-column[
#### Tidy Data

1. Each **variable** forms a .hl[column]

2. Each **observation** forms a .hl[row]

3. Each **value** is a .hl[cell]
]

--

.right-column[
#### Start by asking

1. What information do I want to use in my visualization?

1. Is that data contained in .hl[one column/row] for a given data point?
]

---

.right-column[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 1997 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2002 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2007 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.599929 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.497046 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.284741 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.212583 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.852401 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.860588 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.081016 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.155814 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19.314747 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

.right-column[

```r
tidy_pop &lt;- gather(messy_pop, 'year', 'pop', -country)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.600 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.213 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.081 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.497 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]


---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics

```r
+ aes()
```

]
---

.right-column[
Map data to visual elements or parameters

- year

- pop

- country

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.600 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.213 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.081 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.497 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

.right-column[
Map data to visual elements or parameters

- year → **x**

- pop → **y**

- country → *shape*, *color*, etc.


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.600 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rwanda &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.213 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Syria &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.081 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chile &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2002 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.497 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

---

.right-column[
Map data to visual elements or parameters

```r
aes(
  x = year,
  y = pop,
  colour = country
)
```
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms

```r
+ geom_*()
```
]

---

.right-column[
Geometric objects displayed on the plot

&lt;img src="index_files/figure-html/geom_demo-1.png" width="650px" /&gt;
]

---

.right-column[
Here are the [some of the most widely used geoms](https://eric.netlify.com/2017/08/10/most-popular-ggplot2-geoms/)

.font70.center[
| Type | Function |
|:----:|:--------:|
| Point | `geom_point()` |
| Line | `geom_line()` |
| Bar | `geom_bar()`, `geom_col()` |
| Histogram | `geom_histogram()` |
| Regression | `geom_smooth()` |
| Boxplot | `geom_boxplot()` |
| Text | `geom_text()` |
| Vert./Horiz. Line | `geom_{vh}line()` |
| Count | `geom_count()` |
| Density | `geom_density()` |

&lt;https://eric.netlify.com/2017/08/10/most-popular-ggplot2-geoms/&gt;
]
]


---

.right-column[

See &lt;http://ggplot2.tidyverse.org/reference/&gt; for many more options

.font70[

```
##  [1] "geom_abline"     "geom_area"       "geom_bar"        "geom_bin2d"     
##  [5] "geom_blank"      "geom_boxplot"    "geom_col"        "geom_contour"   
##  [9] "geom_count"      "geom_crossbar"   "geom_curve"      "geom_density"   
## [13] "geom_density_2d" "geom_density2d"  "geom_dotplot"    "geom_errorbar"  
## [17] "geom_errorbarh"  "geom_freqpoly"   "geom_hex"        "geom_histogram" 
## [21] "geom_hline"      "geom_jitter"     "geom_label"      "geom_line"      
## [25] "geom_linerange"  "geom_map"        "geom_path"       "geom_point"     
## [29] "geom_pointrange" "geom_polygon"    "geom_qq"         "geom_qq_line"   
## [33] "geom_quantile"   "geom_raster"     "geom_rect"       "geom_ribbon"    
## [37] "geom_rug"        "geom_segment"    "geom_sf"         "geom_sf_label"  
## [41] "geom_sf_text"    "geom_smooth"     "geom_spoke"      "geom_step"      
## [45] "geom_text"       "geom_tile"       "geom_violin"     "geom_vline"
```
]
]
--

.right-column[
&lt;img src="images/geom.gif" width="200px" style="float: right; margin-right: 100px; margin-top: -25px;"&gt;
Or just start typing `geom_` in RStudio
]


---
layout: true
# Our first plot!
---

.left-code[

```r
ggplot(tidy_pop)
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot1a-1.png" width="100%" /&gt;
]

---

.left-code[

```r
ggplot(tidy_pop,
* aes(x = year,
*     y = pop)
  )
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot1b-1.png" width="100%" /&gt;
]

---

.left-code[

```r
ggplot(tidy_pop,
  aes(x = year,
      y = pop)
  ) +
* geom_point()
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot1c-1.png" width="100%" /&gt;
]

---

.left-code[

```r
ggplot(tidy_pop,
  aes(x = year,
      y = pop,
*     color = country)
  ) + 
  geom_point()
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot1-1.png" width="100%" /&gt;
]

---

.left-code[

```r
ggplot(tidy_pop,
  aes(x = year,
      y = pop,
      color = country) 
  ) +
  geom_point() +
* geom_line()
```

.font80[
```r
geom_path: Each group consists
of only one observation. 
Do you need to adjust the 
group aesthetic?
```
]
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot2-fake-1.png" width="100%" /&gt;
]
---

.left-code[

```r
ggplot(tidy_pop,
  aes(x = year,
      y = pop,
      color = country) 
  ) +
  geom_point() +
  geom_line(
*   aes(group = country))
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot2-1.png" width="100%" /&gt;
]

---


.left-code[

```r
*g &lt;- ggplot(tidy_pop,
  aes(x = year,
      y = pop,
      color = country) 
  ) +
  geom_point() +
  geom_line(
    aes(group = country))

*g 
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot3-1.png" width="100%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms

```r
+ geom_*()
```
]
---

.right-column[
```r
geom_*(mapping = aes(), data, stat, position)
```

- `data` Geoms can have their own data
    - Has to map onto global coordinates

- `aes` Geoms can have their own aesthetics
    - Inherits global aesthetics
    - Have geom-specific aesthetics
        - `geom_point` needs `x` and `y`, optional `shape`, `color`, `size`, etc.
        - `geom_ribbon` requires `x`, `ymin` and `ymax`, optional `fill`
    - Use `?` to find out the aesthetics required and the ones you can change:
    `?geom_ribbon`
]

---

.right-column[
```r
geom_*(mapping, data, stat, position)
```

- `stat` Some geoms apply further transformations to the data
    - All respect `stat = 'identity'`
    - Ex: `geom_histogram` uses `stat_bin()` to group observations
    
- `position` Some adjust location of objects
    - `'dodge'`, `'stack'`, `'jitter'`
]

---
layout: true
# Our first plot!
---

.left-code[

```r
g &lt;- ggplot() +
  geom_point(
*   data = tidy_pop,
*   aes(x = year,
*     y = pop,
*     color = country)
  ) +
  geom_line(
*   data = tidy_pop,
*   aes(x = year,
*     y = pop,
*     color = country,
*     group = country)
    )

g
```
]

.right-plot[
&lt;img src="index_files/figure-html/first-plot-geom-1-1.png" width="100%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms

```r
+ geom_*()
```
]
---

.right-column[
```r
geom_*(mapping = aes(), data, stat, position)
```

- `data` Geoms can have their own data
    - Has to map onto global coordinates

.font150[What would the advantage be for a geom to have their own data?]

]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms
### Facet

```r
+facet_wrap() 

+facet_grid()
```
]
---



.right-plot[

```r
g + facet_wrap(~ country)
```

&lt;img src="index_files/figure-html/geom_facet-1.png" width="90%" /&gt;
]

---

.right-column[

```r
g + facet_grid(continent ~ country)
```

&lt;img src="index_files/figure-html/geom_grid-1.png" width="90%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms
### Facet
### Labels

```r
+ labs()
```
]
---




.right-column[

```r
(g &lt;- g + labs(x = "Year", y = "Population (millions)"))
```

&lt;img src="index_files/figure-html/labs-ex-1.png" width="90%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms
### Facet
### Labels
### Coords

```r
+ coord_*()
```
]
---




.right-column[

```r
g + coord_flip()
```

&lt;img src="index_files/figure-html/coord-ex-1.png" width="90%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms
### Facet
### Labels
### Coords
### Scales

```r
+ scale_*_*()
```
]
---

.right-column[ 
`scale` + `_` + `&lt;aes&gt;` + `_` + `&lt;type&gt;` + `()`

`&lt;aes&gt;` = parameter to adjust; `&lt;type&gt;` = Parameter Type
]
--

.right-column[
- I want to use a different color palette&lt;br&gt;`scale_fill_discrete()`&lt;br&gt;`scale_color_continuous()`
]

--

.right-column[
- I want to rescale y-axis as log&lt;br&gt;`scale_y_log10()`
]

--

.right-column[
- I want to change my discrete x-axis&lt;br&gt;`scale_x_discrete()`
]



---



.right-column[

```r
g + scale_color_manual(values = c("peru", "pink", "plum"))
```

&lt;img src="index_files/figure-html/scale_ex1-1.png" width="90%" /&gt;
]

---

.right-column[

```r
g + scale_y_log10()
```

&lt;img src="index_files/figure-html/scale_ex2-1.png" width="90%" /&gt;
]

---

.right-column[

```r
g + scale_x_discrete(labels = c("MCMXCVII", "MMII", "MMVII"))
```

&lt;img src="index_files/figure-html/scale_ex4-1.png" width="90%" /&gt;
]

---
layout: true
# gg is for Grammar of Graphics

.left-column[
### Data
### Aesthetics
### Geoms
### Facet
### Labels
### Coords
### Scales
### Theme

```r
+ theme()
```
]

---

.right-column[
Change the appearance of plot decorations&lt;br&gt;
i.e. things that aren't mapped to data

A few "starter" themes ship with the package

- `g + theme_bw()`
- `g + theme_dark()`
- `g + theme_gray()`
- `g + theme_light()`
- `g + theme_minimal()`

]

---

.right-column[


```r
g + theme_bw()
```

&lt;img src="index_files/figure-html/theme_ex1-1.png" width="90%" /&gt;

]

---
.right-column[
Huge number of parameters, grouped by plot area:

- Global options: `line`, `rect`, `text`, `title`
- `axis`: x-, y- or other axis title, ticks, lines
- `legend`: Plot legends
- `panel`: Actual plot area
- `plot`: Whole image
- `strip`: Facet labels
]
---

.right-column[
Theme options are supported by helper functions:

- `element_blank()` removes the element
- `element_line()`
- `element_rect()`
- `element_text()`
]

---

.right-column[
.font80[

```r
g + theme_bw() + theme(text = element_text(colour = "hotpink", size = 20))
```

&lt;img src="index_files/figure-html/unnamed-chunk-1-1.png" width="90%" /&gt;
]
]

---

.right-column[
You can also set the theme globally with `theme_set()`


```r
my_theme &lt;- theme_bw() +
  theme(
    text = element_text(family = "Palatino", size = 12),
    panel.border = element_rect(colour = 'grey80'), 
    panel.grid.minor = element_blank()
  )

theme_set(my_theme)
```

All plots will now use this theme!
]

---

.right-column[

```r
g 
```

&lt;img src="index_files/figure-html/unnamed-chunk-2-1.png" width="90%" /&gt;
]

---

.right-column[

```r
g + theme(legend.position = 'bottom')
```

&lt;img src="index_files/figure-html/unnamed-chunk-3-1.png" width="90%" /&gt;
]

---
layout: false
# Save Your Work

To save your plot, use **ggsave**. 


```r
ggsave(
  filename = "my_plot.png",
  plot = my_plot,
  width = 10,
  height = 8,
  dpi = 100,
  device = "png"
)
```

---
layout: false
class: inverse center middle text-white

.font200[You have the power!]
---

class: inverse, center, middle

# "Live" Coding


```r
library(gapminder)
```



---
# head(gapminder)

&lt;div class="kable-table"&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; continent &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; lifeExp &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; gdpPercap &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1952 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.801 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8425333 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 779.4453 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1957 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.332 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9240934 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 820.8530 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1962 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31.997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10267083 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 853.1007 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1967 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.020 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11537966 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 836.1971 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1972 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.088 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13079460 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 739.9811 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1977 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38.438 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14880372 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 786.1134 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;/div&gt;

---
# glimpse(gapminder)


```
Observations: 1,704
Variables: 6
$ country   &lt;fct&gt; Afghanistan, Afghanistan, Afghanistan, Afghanistan, Afghanistan, Af...
$ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, A...
$ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2...
$ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.822, 41....
$ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12881816,...
$ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, 978.011...
```

--

Let's start with `lifeExp` vs `gdpPercap`

---
class: fullscreen
layout: true
---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp))
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-1-1.png)
]

--

Add points...

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp)) +
* geom_point()
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-2-1.png)
]

--

How can I tell countries apart?

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
*     color = continent)) +
  geom_point()
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-3-1.png)
]

--

GDP is squished together on the left

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
  geom_point() +
* scale_x_log10()
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-4-1.png)
]

--

Still lots of overlap in the countries...

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
  geom_point() +
  scale_x_log10() +
* facet_wrap(~ continent) +
* guides(color = FALSE)
```

No need for color legend thanks to facet titles
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-5-1.png)
]

--

Lots of overplotting due to point size

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
* geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-6-1.png)
]

--

Is there a trend?

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
* geom_line() +
  #geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-7-1.png)
]

--

Okay, that line just connected all of the points sequentially...

---

.left-code[

```r
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
  geom_line(
*   aes(group = country)
    ) +
  #geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```

.font200.center[&amp;#x1F914;]
]

.right-plot[
![](index_files/figure-html/gapminder-le-gdp-8-1.png)
]

--

&amp;#x1F4A1; We need time on x-axis!

---

.left-code[

```r
ggplot(gapminder,
* aes(x = year,
*     y = gdpPercap,
      color = continent)) +
  geom_line(
    aes(group = country)) +
  #geom_point(size = 0.25) +
* scale_y_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-gdp-year-1-1.png)
]

--

Can't see x-axis labels, though

---

.left-code[

```r
ggplot(gapminder,
  aes(x = year,
      y = gdpPercap,
      color = continent)) +
  geom_line(
    aes(group = country)) +
  #geom_point(size = 0.25) +
  scale_y_log10() +
* scale_x_continuous(breaks =
*   seq(1950, 2000, 25)
* ) +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-gdp-year-2-1.png)
]

--

What about life expectancy?

---

.left-code[

```r
ggplot(gapminder, 
  aes(x = year, 
*     y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country)) +
  #geom_point(size = 0.25) +
* #scale_y_log10() +
  scale_x_continuous(breaks = 
    seq(1950, 2000, 25)) +  
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-1-1.png)
]

--

Okay, let's add a trend line

---

.left-code[

```r
ggplot(gapminder,
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country)) +
  # geom_point(size = 0.25) +
* geom_smooth() +
  scale_x_continuous(breaks = 
    seq(1950, 2000, 25)) +  
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-2-1.png)
]

--

De-emphasize individual countries

---

.left-code[

```r
ggplot(gapminder,
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country),
*   alpha = 0.2) +
  #geom_point(size = 0.25) +
  geom_smooth() + 
  scale_x_continuous(breaks = 
    seq(1950, 2000, 25)) +  
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-3-1.png)
]

--

Let's compare continents

---

.left-code[

```r
ggplot(gapminder,
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country),
    alpha = 0.2) +
  geom_smooth() + 
  # scale_x_continuous(
  #   breaks = 
  #     seq(1950, 2000, 25))+
* # facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-5-1.png)
]

--

Wait, what color is each continent?

---

.left-code[

```r
ggplot(gapminder, 
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country),
    alpha = 0.2) +
  geom_smooth() + 
* theme(
* legend.position = "bottom")
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-6-1.png)
]

--

Let's try the minimal theme

---

.left-code[

```r
ggplot(gapminder, 
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country),
    alpha = 0.2) +
  geom_smooth() + 
* theme_minimal() +
  theme(
  legend.position = "bottom")
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-7-1.png)
]

--

Fonts are kind of big

---

.left-code[

```r
ggplot(gapminder, 
  aes(x = year, 
      y = lifeExp,
      color = continent)) +
  geom_line(
    aes(group = country),
    alpha = 0.2) +
  geom_smooth() + 
  theme_minimal( 
*   base_size = 10) +
  theme(
  legend.position = "bottom")
```
]

.right-plot[
![](index_files/figure-html/gapminder-le-year-8-1.png)
]

--

Great, let's switch gears

---

.left-code[

```r
americas &lt;- 
  gapminder %&gt;% 
  filter(
    country %in% c(
      "Brazil",
      "Canada",
      "Mexico",
      "Ecuador"
    )
  )
```

Let's look at four countries in more detail. How do their populations compare to each other?
]

.right-plot[
&lt;!-- ![](index_files/figure-html/gapminder-le-year-8-1.png) --&gt;
&lt;div class="kable-table"&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; continent &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; lifeExp &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; gdpPercap &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1952 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.917 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56602560 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2108.944 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1957 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53.285 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65551171 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2487.366 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1962 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55.665 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76039390 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3336.586 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1967 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57.632 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 88049823 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3429.864 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1972 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59.504 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100840058 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4985.711 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1977 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61.489 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114313951 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6660.119 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1982 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.336 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 128962939 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7030.836 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1987 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.205 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 142938076 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7807.096 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1992 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 67.057 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 155975974 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6950.283 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Brazil &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1997 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.388 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 168546719 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7957.981 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;/div&gt;
]

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = pop) 
  ) +
  geom_col()
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-1-1.png)
]

--

Yeah, but how many people are in each country?

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = pop,
*     fill = country)
  ) +
  geom_col()
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-2-1.png)
]

--

Can we reorder by population size?

---

.left-code[

Excellent tutorial by Jenny Bryan ["Be the Boss of your factors"](https://stat545.com/factors-boss.html)


```r
ggplot(americas,
  aes(x = year,
      y = pop,
*     fill = fct_reorder(
*       country, pop)
      )
  ) +
  geom_col()
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-2-1-1.png)
]

--

Can we change the labels?

---

.left-code[

Excellent tutorial by Jenny Bryan ["Be the Boss of your factors"](https://stat545.com/factors-boss.html)


```r
ggplot(americas,
  aes(x = year,
      y = pop,
*     fill = fct_reorder(
*       country, pop)
      )
  ) +
  geom_col() +
* labs(fill = "Country")
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-2-2-1.png)
]

--

Bars are "stacked", can we separate?

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = pop,
      fill = fct_reorder(  
        country, pop) 
      )
  ) +
  geom_col(
*   position = "dodge") +
  labs(fill = "Country") 
```

`position = "dodge"` places objects _next to each other_ instead of overlapping
]

.right-plot[
![](index_files/figure-html/gapminder-americas-3-1.png)
]

--

&amp;#x1F913; What is scientific notation anyway?

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
*     y = pop / 10^6,
      fill = fct_reorder(  
        country, pop)
      ) 
  ) +
  geom_col(
    position = "dodge" 
  ) +
  labs(fill = "Country", 
*      y = "Population (millions)"
       )  
```

ggplot aesthetics can take expressions!
]

.right-plot[
![](index_files/figure-html/gapminder-americas-4-1.png)
]

--

Might be easier to see countries individually

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
*     y = pop / 10^6,
*     fill = country)
  ) +
  geom_col(
    position = "dodge" 
  ) +
  labs(y = "Population (millions)") + 
* facet_wrap(~ country) +
* guides(fill = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-5-1.png)
]

--

Let range of y-axis vary in each plot

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = pop / 10^6, 
      fill = country)
  ) +
  geom_col(
    position = "dodge" 
  ) +
  labs(y = "Population (millions)") + 
  facet_wrap(~ country,
*   scales = "free_y") +
  guides(fill = FALSE) 
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-6-1.png)
]

--

What about life expectancy again?

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
*     y = lifeExp,
      fill = country)
  ) +
  geom_col(
    position = "dodge" 
  ) +
  facet_wrap(~ country,
             scales = "free_y") +
  guides(fill = FALSE) 
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-7-1.png)
]

--

This should really be &amp;#x1F4C8; instead of &amp;#x1F4CA;

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = lifeExp, 
      fill = country)
  ) +
* geom_line() +
  facet_wrap(~ country,
             scales = "free_y") +
  guides(fill = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-8-1.png)
]

--

&amp;#x1F4CA; are **fill**ed, &amp;#x1F4C8; are **color**ed

---

.left-code[

```r
ggplot(americas) +
  aes(
    x = year,
    y = lifeExp,
*   color = country
  ) +
  geom_line() +
  facet_wrap(~ country,
    scales = "free_y") +
* guides(color = FALSE)
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-9-1.png)
]

--

Altogether now!

---

.left-code[

```r
ggplot(americas) +
  aes(
    x = year,
    y = lifeExp,
    color = country
  ) +
  geom_line()
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-10-1.png)
]

--

Let's update the labels

---

.left-code[

```r
ggplot(americas,
  aes(x = year,
      y = lifeExp,
      color = country)
  ) +
  geom_line() +
  labs(x = "Year",
       y = "Life expectancy (years)",
       color = "Country",
       title = "Life expectancy over time")
```
]

.right-plot[
![](index_files/figure-html/gapminder-americas-11-1.png)
]

--

Okay, changing gears again. What is range of life expectancy in Americas?

---

.left-code[

```r
gapminder %&gt;% 
  filter(
    continent == "Americas"
* ) %&gt;%
* ggplot(
    aes(x = year,
        y = lifeExp) 
  )
```

You can pipe into `ggplot()`!  
Just watch for `%&gt;%` changing to `+`
]

.right-plot[
![](index_files/figure-html/gapminder-all-americas-1-1.png)
]

--

Boxplot for life expectancy range

---

.left-code[

```r
gapminder %&gt;% 
  filter(
    continent == "Americas"
  ) %&gt;% 
  ggplot( 
    aes(x = year, 
        y = lifeExp) 
  ) + 
* geom_boxplot()
```
]

.right-plot[
![](index_files/figure-html/gapminder-all-americas-2-1.png)
]

--

Why not boxplots by year?

---

.left-code[

```r
gapminder %&gt;% 
  filter(
    continent == "Americas"
  ) %&gt;%
* mutate(
*   year = factor(year)
* ) %&gt;%
  ggplot( 
    aes(x = year, 
        y = lifeExp) 
  ) + 
  geom_boxplot()
```
]

.right-plot[
![](index_files/figure-html/gapminder-all-americas-3-1.png)
]

---

.left-code[

```r
gapminder %&gt;% 
  filter(
    continent == "Americas"
  ) %&gt;%
  mutate(
    year = factor(year) 
  ) %&gt;%  
  ggplot( 
    aes(x = year, 
        y = lifeExp) 
  ) + 
  geom_boxplot() +
* coord_flip()
```
]

.right-plot[
![](index_files/figure-html/gapminder-all-americas-4-1.png)
]

---
layout: false
class: inverse, middle, center

# Recap and where to go next
---
layout: true
# Plots are built in layers
---

.font120[
- **Data** must be in a "tidy" format.
]

--
.font120[
- **.hlb[Aes]thetic mappings** link variables in the data to graphical properties in the **.hlb[geom]**etric objects.

]

--
.font120[
- **.hlb[Geom]etric objects** dictate how the **.hlb[aes]thetics** are interpreted as a graphical representation (points, lines, polygons, etc.)
]

--
.font120[
- **.hlb[Stat]istics** transform the input variables to displayed values. E.g. calculate the summary statistics for a boxplot (quantiles).
]

--
.font120[
- **.hlb[Coord]inates** organize location of geometric objects, i.e. define the physical mapping of the aesthetics.
]

---
layout: true
# Plots are built in layers
---

.font120[
- **.hlb[Scale]s** define the range of values for aesthetics (e.g. categories -&gt; colours).
]

--
.font120[
- **.hlb[Facet]s** define the number of panels and how to split data among them (e.g. by country).
]

--
.font120[
- **.hlb[Theme]s** control every part of the graphic that is not linked to the data (i.e. font, visual appearance).
]

---
layout: true
# Stack Exchange is Great!
---

![](images/stack-exchange-search.png)

---

&lt;img src="images/stack-exchange-answer.png" style="max-height: 100%"&gt;

---
layout: false

# ggplot2 Extensions: ggplot2-exts.org

&lt;img src="images/ggplot2-exts-gallery.png" style="max-height: 90%"&gt;

---
# ggplot2 and beyond

### Learn more

- **Draw anything with ggplot2**: &lt;https://github.com/thomasp85/ggplot2_workshop&gt;

- **Be the boss of your factors and other useful tips:** &lt;https://stat545.com/index.html&gt;

- **ggplot2 docs:** &lt;http://ggplot2.tidyverse.org/&gt;

- **R4DS - Data visualization:** &lt;http://r4ds.had.co.nz/data-visualisation.html&gt;

- **Hadley Wickham's ggplot2 book:** &lt;https://www.amazon.com/dp/0387981403/&gt;

---
# ggplot2 and beyond

### Noteworthy RStudio Add-Ins

- [esquisse](https://github.com/dreamRs/esquisse): Interactively build ggplot2 plots

- [ggplotThemeAssist](https://github.com/calligross/ggthemeassist): Customize your ggplot theme interactively

- [ggedit](https://github.com/metrumresearchgroup/ggedit): Layer, scale, and theme editing

---

# Practice and Review

### #TidyTuesday

- &lt;https://github.com/rfordatascience/tidytuesday&gt;

### Fun Datasets

- `fivethirtyeight`

- `nycflights`

- `ggplot2movies`

---
class: inverse, center, middle

# Thanks!

.font150.text-white[
- Slides and code adapted from Garrick Aden-Buie GitHub: &lt;http://github.com/gadenbuie/gentle-ggplot2&gt;
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "foundation",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
